.TH PERFQUERY 8 "February 19, 2011" "OpenIB" "OpenIB Diagnostics"

.SH NAME
perfquery \- query InfiniBand port counters

.SH SYNOPSIS
.B perfquery
[\-d(ebug)] [\-G(uid)] [\-x|\-\-extended] [\-X|\-\-xmtsl] [\-S|\-\-rcvsl]
[\-D|\-\-xmtdisc] [\-E|\-\-rcverr] [\-T|\-\-extended_speeds][\-\-oprcvcounters] [\-\-flowctlcounters]
[\-\-vloppackets] [\-\-vlopdata] [\-\-vlxmitflowctlerrors] [\-\-vlxmitcounters]
[\-\-swportvlcong] [\-\-rcvcc] [\-\-slrcvfecn] [\-\-slrcvbecn] [\-\-xmitcc]
[\-\-vlxmittimecc] [\-c|\-\-smplctl] [-a(ll_ports)] [-l(oop_ports)]
[-r(eset_after_read)] [-R(eset_only)] [\-C ca_name] [\-P ca_port] [\-t(imeout) timeout_ms]
[\-V(ersion)] [\-h(elp)] [<lid|guid> [[port] [reset_mask]]]

.SH DESCRIPTION
.PP
perfquery uses PerfMgt GMPs to obtain the PortCounters (basic performance
and error counters), PortExtendedCounters, PortXmitDataSL, PortRcvDataSL,
PortRcvErrorDetails, PortXmitDiscardDetails, PortExtendedSpeedsCounters, or PortSamplesControl
from the PMA at the node/port specified. Optionally shows aggregated
counters for all ports of node.
Also, optionally, reset after read, or only reset counters.

Note: In PortCounters, PortCountersExtended, PortXmitDataSL, and PortRcvDataSL,
components that represent Data (e.g. PortXmitData and PortRcvData) indicate
octets divided by 4 rather than just octets.

Note: Inputting a port of 255 indicates an operation be performed on all ports.

.SH OPTIONS

.PP
See infiniband-diags(8) for common options.

.PP
.TP
\fB\-x\fR, \fB\-\-extended\fR
show extended port counters rather than (basic) port counters.
Note that extended port counters attribute is optional.
.TP
\fB\-X\fR, \fB\-\-xmtsl\fR
show transmit data SL counter. This is an optional counter for QoS.
.TP
\fB\-S\fR, \fB\-\-rcvsl\fR
show receive data SL counter. This is an optional counter for QoS.
.TP
\fB\-D\fR, \fB\-\-xmtdisc\fR
show transmit discard details. This is an optional counter.
.TP
\fB\-E\fR, \fB\-\-rcverr\fR
show receive error details. This is an optional counter.
.TP
\fB\-D\fR, \fB\-\-xmtdisc\fR
show transmit discard details. This is an optional counter.
.TP
\fB\-T\fR, \fB\-\-extended_speeds\fR
show extended speeds port counters. This is an optional counter.
.TP
\fB\-\-oprcvcounters\fR
show Rcv Counters per Op code. This is an optional counter.
.TP
\fB\-\-flowctlcounters\fR
show flow control counters. This is an optional counter.
.TP
\fB\-\-vloppackets\fR
show packets received per Op code per VL. This is an optional counter.
.TP
\fB\-\-vlopdata\fR
show data received per Op code per VL. This is an optional counter.
.TP
\fB\-\-vlxmitflowctlerrors\fR
show flow control update errors per VL. This is an optional counter.
.TP
\fB\-\-vlxmitcounters\fR
show ticks waiting to transmit counters per VL. This is an optional counter.
.TP
\fB\-\-swportvlcong\fR
show sw port VL congestion. This is an optional counter.
.TP
\fB\-\-rcvcc\fR
show Rcv congestion control counters. This is an optional counter.
.TP
\fB\-\-slrcvfecn\fR
show SL Rcv FECN counters. This is an optional counter.
.TP
\fB\-\-slrcvbecn\fR
show SL Rcv BECN counters. This is an optional counter.
.TP
\fB\-\-xmitcc\fR
show Xmit congestion control counters. This is an optional counter.
.TP
\fB\-\-vlxmittimecc\fR
show VL Xmit Time congestion control counters. This is an optional counter.
.TP
\fB\-c\fR, \fB\-\-smplctl\fR
show port samples control.
.TP
\fB\-a\fR, \fB\-\-all_ports\fR
show aggregated counters for all ports of the destination lid
or reset all counters for all ports.  If the destination lid
does not support the AllPortSelect flag, all ports will be
iterated through to emulate AllPortSelect behavior.
.TP
\fB\-l\fR, \fB\-\-loop_ports\fR
If all ports are selected by the user (either through the
\fB\-a\fR option or port 255) iterate through each port
rather than doing than aggregate operation.
.TP
\fB\-r\fR, \fB\-\-reset_after_read\fR
reset counters after read
.TP
\fB\-R\fR, \fB\-\-Reset_only\fR
only reset counters


.SH EXAMPLES

.PP
perfquery               # read local port performance counters
.PP
perfquery 32 1          # read performance counters from lid 32, port 1
.PP
perfquery -x 32 1       # read extended performance counters from lid 32, port 1
.PP
perfquery -a 32         # read perf counters from lid 32, all ports
.PP
perfquery -r 32 1       # read performance counters and reset
.PP
perfquery -x -r 32 1    # read extended performance counters and reset
.PP
perfquery -R 0x20 1     # reset performance counters of port 1 only
.PP
perfquery -x -R 0x20 1  # reset extended performance counters of port 1 only
.PP
perfquery -R -a 32      # reset performance counters of all ports
.PP
perfquery -R 32 2 0x0fff # reset only error counters of port 2
.PP
perfquery -R 32 2 0xf000 # reset only non-error counters of port 2

.SH AUTHOR
.TP
Hal Rosenstock
.RI < hal.rosenstock@gmail.com >
