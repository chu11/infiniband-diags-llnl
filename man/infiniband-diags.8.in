.TH INFINIBAND-DIAGS 8 "Aug 15, 2011" "OpenIB" "OpenIB Diagnostics"

.SH SYNOPSIS
.B infiniband-diags

.SH DESCRIPTION
.PP
infiniband-diags is a set of utilities designed to help configure, debug, and
maintain infiniband fabrics.  Many tools and utilities are provided.  Some with
similar functionality.

The base utilities use directed route MAD's to perform their operations.  They
may therefore work even in unconfigured subnets.  Other, higher level
utilities, require LID routed MAD's and to some extent SA/SM access.

Multiple port/Multiple CA support: when no IB device or port is specified
(see the "local umad parameters" below), the libibumad library
selects the port to use by the following criteria:

	1. the first port that is ACTIVE.
.br
	2. if not found, the first port that is UP (physical link up).
.br

.br
	If a port and/or CA name is specified, the libibumad library attempts to fulfill the user request, and will fail if it is not possible.
.br

.br
	For example:
.br
	ibaddr 			# use the 'best port'
.br
	ibaddr -C mthca1	# pick the best port from mthca1 only.
.br
	ibaddr -P 2		# use the second (active/up) port from the first available IB device.
.br
	ibaddr -C mthca0 -P 2	# use the specified port only.


.SH COMMON OPTIONS

Most OpenIB diagnostics take the following common flags. The exact list of
supported flags per utility can be found in the usage message and can be shown
using "<util_name> -h".

.TP
\fB# Addressing Flags\fR

.TP 2
.PP
\fB\-D\fR      use the directed route specified.
.br
		Examples:
.br
		"0" 		# self port
.br
		"0,1,2,1,4"	# out via port 1, then 2, ...

.TP 2
.PP
\fB\-G <guid>\fR     use the PortGuid specified.
.TP 2
.PP
\fB\-s <smlid>\fR     use <smlid> as the target lid for SA queries.

.TP
\fB# Local HCA/port flags:\fR

.TP 2
.PP
\fB\-C <ca_name>\fR    use the specified ca_name.
.TP 2
.PP
\fB\-P <ca_port>\fR    use the specified ca_port.

Multiple CA/Multiple Port Support

When no IB device or port is specified, the port to use is selected
by the following criteria:
.TP 2
.PP
1. the first port that is ACTIVE.
.TP 2
.PP
2. if not found, the first port that is UP (physical link up).

If a port and/or CA name is specified, the user request is
attempted to be fulfilled, and will fail if it is not possible.

.TP
\fB# Debugging flags\fR

.TP 2
.PP
\fB\-t <timeout_ms>\fR override the default timeout for the solicited mads.
.TP 2
.PP
\fB\-d\fR      raise the IB debugging level.
        May be used several times (-ddd or -d -d -d).
.TP 2
.PP
\fB\-e\fR      show send and receive errors (timeouts and others)
.TP 2
.PP
\fB\-h\fR      show the usage message
.TP 2
.PP
\fB\-v\fR      increase the application verbosity level.
        May be used several times (-vv or -v -v -v)
.TP 2
.PP
\fB\-V\fR      show the version info.

.TP
\fB# Configuration flags\fR

.TP 2
.PP
\fB\-\-config\fR, \fB\-z\fR  <config_file>
        Specify alternate config file.
        Default: @IBDIAG_CONFIG_PATH@/ibdiag.conf

.SH COMMON FILES

.TP
\fBGLOBAL CONFIG\fR

.br
\fB@IBDIAG_CONFIG_PATH@/ibdiag.conf\fR

A global config file is provided to set some of the common options for all
tools.  See supplied config file for details.


.TP
\fBNODE NAME MAP FILE FORMAT\fR
Most utilities use the optional node name map file supported by libosmcomp to
specify user friendly names for nodes in the output.  Node GUIDs are used to
perform the lookup.

.TP
\fBGenerically:\fR

# comment
.br
<guid> "<name>"

.TP
\fBExample:\fR

# IB1
.br
# Line cards
.br
0x0008f104003f125c "IB1 (Rack 11 slot 1   ) ISR9288/ISR9096 Voltaire sLB-24D"
.br
0x0008f104003f125d "IB1 (Rack 11 slot 1   ) ISR9288/ISR9096 Voltaire sLB-24D"
.br
0x0008f104003f10d2 "IB1 (Rack 11 slot 2   ) ISR9288/ISR9096 Voltaire sLB-24D"
.br
0x0008f104003f10d3 "IB1 (Rack 11 slot 2   ) ISR9288/ISR9096 Voltaire sLB-24D"
.br
0x0008f104003f10bf "IB1 (Rack 11 slot 12  ) ISR9288/ISR9096 Voltaire sLB-24D"
.br
.br
# Spines
.br
0x0008f10400400e2d "IB1 (Rack 11 spine 1   ) ISR9288 Voltaire sFB-12D"
.br
0x0008f10400400e2e "IB1 (Rack 11 spine 1   ) ISR9288 Voltaire sFB-12D"
.br
0x0008f10400400e2f "IB1 (Rack 11 spine 1   ) ISR9288 Voltaire sFB-12D"
.br
0x0008f10400400e31 "IB1 (Rack 11 spine 2   ) ISR9288 Voltaire sFB-12D"
.br
0x0008f10400400e32 "IB1 (Rack 11 spine 2   ) ISR9288 Voltaire sFB-12D"
.br
.br
# GUID   Node Name
.br
0x0008f10400411a08 "SW1  (Rack  3) ISR9024 Voltaire 9024D"
.br
0x0008f10400411a28 "SW2  (Rack  3) ISR9024 Voltaire 9024D"
.br
0x0008f10400411a34 "SW3  (Rack  3) ISR9024 Voltaire 9024D"
.br
0x0008f104004119d0 "SW4  (Rack  3) ISR9024 Voltaire 9024D"
.br

.SH UTILITIES LIST

.TP
\fBBasic fabric conectivity\fR

	See: ibnetdiscover, iblinkinfo, ibidsverify

.TP
\fBNode information\fR

	See: ibnodes, ibswitches, ibhosts, ibrouters

.TP
\fBPort information\fR

	See: ibportstate, ibaddr

.TP
\fBSwitch Forwarding Table info\fR

	See: ibtracert, ibroute, dump_lfts, dump_mfts, check_lft_balance, ibfindnodesusing

.TP
\fBPeformance counters\fR

	See: ibqueryerrors, perfquery

.TP
\fBLocal HCA info\fR

	See: ibstat

.TP
\fBConnectivity check\fR

	See: ibping, ibsysstat

.TP
\fBLow level query tools\fR

	See: smpquery, smpdump, saquery, sminfo


.SH Backwards compatibility scripts

The following scripts have been identified as redundant and/or lower performing
as compared to the above scripts.  They are provided as legacy scripts when
--enable-compat-utils is specified at build time.

ibcheckerrors, ibclearcounters, ibclearerrors, ibdatacounters
ibchecknet, ibchecknode, ibcheckport, ibcheckportstate,
ibcheckportwidth, ibcheckstate, ibcheckwidth, ibswportwatch,
ibprintca, ibprintrt, ibprintswitch, ibstatus


.SH AUTHORS
.TP
Ira Weiny
.RI < weiny2@llnl.gov >
