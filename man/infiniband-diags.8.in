.TH INFINIBAND-DIAGS 8 "Aug 15, 2011" "OpenIB" "OpenIB Diagnostics"

.SH SYNOPSIS
.B infiniband-diags

.SH DESCRIPTION
.PP
infiniband-diags is a set of utilities designed to help configure, debug, and
maintain infiniband fabrics.  Many tools and utilities are provided.  Some with
similar functionality.

The base utilities use directed route MAD's to perform their operations.  They
may therefore work even in unconfigured subnets.  Other, higher level
utilities, require LID routed MAD's and to some extent SA/SM access.

Multiple port/Multiple CA support: when no IB device or port is specified
(see the "local umad parameters" below), the libibumad library
selects the port to use by the following criteria:

	1. the first port that is ACTIVE.
.br
	2. if not found, the first port that is UP (physical link up).
.br

.br
	If a port and/or CA name is specified, the libibumad library attempts to fulfill the user request, and will fail if it is not possible.
.br

.br
	For example:
.br
	ibaddr 			# use the 'best port'
.br
	ibaddr -C mthca1	# pick the best port from mthca1 only.
.br
	ibaddr -P 2		# use the second (active/up) port from the first available IB device.
.br
	ibaddr -C mthca0 -P 2	# use the specified port only.


.SH COMMON OPTIONS

Most OpenIB diagnostics take the following common flags. The exact list of
supported flags per utility can be found in the usage message and can be shown
using "<util_name> -h".

.TP
\fB# Addressing Flags\fR
.PP
\-D      use the directed route specified.
.br
		Examples:
.br
		"0" 		# self port
.br
		"0,1,2,1,4"	# out via port 1, then 2, ...

.PP
\-G <guid>     use the PortGuid specified.
.PP
\-s <smlid>     use 'smlid' as the target lid for SA queries.

.TP
\fB# Local HCA/port flags:\fR
.PP
\-C <ca_name>    use the specified ca_name.
.PP
\-P <ca_port>    use the specified ca_port.

.TP
\fB# Debugging flags\fR
.PP
\-t <timeout_ms> override the default timeout for the solicited mads.
.PP
\-d      raise the IB debugging level.
        May be used several times (-ddd or -d -d -d).
.PP
\-e      show send and receive errors (timeouts and others)
.PP
\-h      show the usage message
.PP
\-v      increase the application verbosity level.
        May be used several times (-vv or -v -v -v)
.PP
\-V      show the version info.

.TP
\fB# Configuration flags\fR
.PP
\-\-config \-z  <config_file>
        Specify alternate config file.
        Default: @IBDIAG_CONFIG_PATH@/ibdiag.conf

.SH FILES

@IBDIAG_CONFIG_PATH@/ibdiag.conf

A global config file is provided to set some of the common options for all
tools.  See supplied config file for details.


.SH NODE NAME MAP FILE FORMAT
Most utilities use the optional node name map file supported by libosmcomp to
specify user friendly names for nodes in the output.  Node GUIDs are used to
perform the lookup.

.TP
\fBGenerically:\fR

# comment
.br
<guid> "<name>"

.TP
\fBExample:\fR

# IB1
.br
# Line cards
.br
0x0008f104003f125c "IB1 (Rack 11 slot 1   ) ISR9288/ISR9096 Voltaire sLB-24D"
.br
0x0008f104003f125d "IB1 (Rack 11 slot 1   ) ISR9288/ISR9096 Voltaire sLB-24D"
.br
0x0008f104003f10d2 "IB1 (Rack 11 slot 2   ) ISR9288/ISR9096 Voltaire sLB-24D"
.br
0x0008f104003f10d3 "IB1 (Rack 11 slot 2   ) ISR9288/ISR9096 Voltaire sLB-24D"
.br
0x0008f104003f10bf "IB1 (Rack 11 slot 12  ) ISR9288/ISR9096 Voltaire sLB-24D"
.br
.br
# Spines
.br
0x0008f10400400e2d "IB1 (Rack 11 spine 1   ) ISR9288 Voltaire sFB-12D"
.br
0x0008f10400400e2e "IB1 (Rack 11 spine 1   ) ISR9288 Voltaire sFB-12D"
.br
0x0008f10400400e2f "IB1 (Rack 11 spine 1   ) ISR9288 Voltaire sFB-12D"
.br
0x0008f10400400e31 "IB1 (Rack 11 spine 2   ) ISR9288 Voltaire sFB-12D"
.br
0x0008f10400400e32 "IB1 (Rack 11 spine 2   ) ISR9288 Voltaire sFB-12D"
.br
.br
# GUID   Node Name
.br
0x0008f10400411a08 "SW1  (Rack  3) ISR9024 Voltaire 9024D"
.br
0x0008f10400411a28 "SW2  (Rack  3) ISR9024 Voltaire 9024D"
.br
0x0008f10400411a34 "SW3  (Rack  3) ISR9024 Voltaire 9024D"
.br
0x0008f104004119d0 "SW4  (Rack  3) ISR9024 Voltaire 9024D"
.br


.SH IB FABRIC CONFIG

\fBibfabricconf.xml\fR is an XML file which describes all the connections in a
fabric.  The 2 dtd's are provided ibfabric.dtd and ibchassismap.dtd.  Over all
the config file provides the following features:

.TP
Config entry's are "name" based.  There are no GUID's, LIDs, etc.  As such
misnamed nodes (possibly supplied by the conf file "ib-node-name-map" or by
miss-programmed node description fields) will show up as errors.  The reasoning
for this is iblinkinfo is a tool used by System Administrators to debug
problems in a known network layout.  GUID's can change as bad hardware is
swapped out.  Therefore a logical view of the fabric is much more useful and
presented in ibfabricconf.xml

.TP
Ports which are not specified are assumed to be down.
Checks during a fabric scan will report active links on those ports as errors.

.TP
Default properties are "MAX" speed and "MAX" width.  This instructs the
checking program to compare the active speed/width against the supported
speed/width and flag an error if the active speed/wdith is not equal to the max
supported.

.TP
Properties are inherited from parent to child in the XML file.  For example if
the entire fabric is to be 4X/QDR then only the fabric XML tag needs to be
specified as 'speed="QDR" width="4X"'.  However, any link/node tag can specify
properties which overrides itself and it's children.

.TP
Ports which are listed a second time will over ride the previous entry.
This is very useful for overriding the internal links of the large
switches after using the "chassis" tag.  On the other hand caution should
be used in generating your config files.

.TP
Common "chassis" configs can be included using the "chassis" tag.  This makes
defining the internal connections of large switches easier.  Using a chassis
tag will automatically create all the internal links for those switches.  The
name of the chassis will be prepended to the internal switches found in the
chassis.  For example:

<chassis name="ibcore1" model="QLogic_9240"></chassis>

results to the following "linklist" names:

"ibcore1 SP1a", "ibcore1 SP1b", ...

"ibcore1 L1a", "ibcore1 L2a", "ibcore1 Leaf 3 Chip A", ...

Internal switch names can be changed if the names used in the config file
are not sufficient.

(See @IBDIAG_CONFIG_PATH@/chassis_fabricconfs
for a list of chassis which have alredy been defined.  Submitions of
additional chasis config files are always welcome.)

.TP
A "subfabric" tag allows an easier method to specify the properties for a group
of entries.


.SH UTILITIES LIST

.TP
\fBBasic fabric conectivity\fR

	See: ibnetdiscover, iblinkinfo, ibidsverify

.TP
\fBNode information\fR

	See: ibnodes, ibswitches, ibhosts, ibrouters

.TP
\fBPort information\fR

	See: ibportstate, ibaddr

.TP
\fBSwitch Forwarding Table info\fR

	See: ibtracert, ibroute, dump_lfts, dump_mfts, check_lft_balance, ibfindnodesusing

.TP
\fBPeformance counters\fR

	See: ibqueryerrors, perfquery

.TP
\fBLocal HCA info\fR

	See: ibstat, ibstatus

.TP
\fBConnectivity check\fR

	See: ibping, ibsysstat

.TP
\fBLow level query tools\fR

	See: smpquery, smpdump, saquery, sminfo


.SH Backwards compatibility scripts

The following scripts have been identified as redundant and/or lower performing
as compared to the above scripts.  They are provided as legacy scripts when
--enable-compat-utils is specified at build time.

ibcheckerrors, ibclearcounters, ibclearerrors, ibdatacounters
ibchecknet, ibchecknode, ibcheckport, ibcheckportstate,
ibcheckportwidth, ibcheckstate, ibcheckwidth, ibswportwatch,
ibprintca, ibprintrt, ibprintswitch


.SH AUTHORS
.TP
Ira Weiny
.RI < weiny2@llnl.gov >
